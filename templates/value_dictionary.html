{% extends "base.html" %}

{% block title %}–°–ª–æ–≤–∞—Ä—å –ó–Ω–∞—á–µ–Ω–∏–π{% endblock %}

{% block content %}
<div class="container">
    <div style="text-align: center; margin-bottom: 2em;">
        <h1>–°–ª–æ–≤–∞—Ä—å –ó–Ω–∞—á–µ–Ω–∏–π</h1>
        <p class="instruction-text">–û–¥–Ω–æ–º—É —Å–ª–æ–≤—É –¥–ª—è –∑–∞–º–µ–Ω—ã –º–æ–∂–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–º–µ–Ω—è–µ–º—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.</p>
    </div>

    <div class="dictionary-layout">

        <aside class="add-entry-card">
            <h3 id="form-title">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ</h3>
            <form id="value-dict-form" action="/value-dictionary/add" method="POST">
                <div class="form-group">
                    <label for="canonical_word">–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞</label>
                    <input type="text" id="canonical_word" name="canonical_word" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ü–æ–∫–∞" required>
                </div>
                <div class="form-group">
                    <label for="find_words">–°–ª–æ–≤–∞ –¥–ª—è –∑–∞–º–µ–Ω—ã (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: @1!)</label>
                    <input type="text" id="find_words" name="find_words" placeholder="–ü—Ä–∏–≤–µ—Ç@1!" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="cancel-edit-btn" class="btn" style="width: 100%; margin-top: 10px; display: none;" onclick="cancelEdit()">–û—Ç–º–µ–Ω–∏—Ç—å</button>
            </form>
        </aside>

        <main class="dictionary-list">
            {% if rules %}
                {% for canonical, find_list in rules.items() %}
                <div class="dictionary-entry-card">
                    <div class="entry-header">
                        <h2 class="canonical-name">"{{ canonical }}"</h2>
                        <div>
                            <button class="edit-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                                    onclick="editRule('{{ canonical }}', '{{ find_list|join('@1!') }}')">‚úèÔ∏è</button>
                            <form action="/value-dictionary/delete" method="POST" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?');" style="display: inline;">
                                <input type="hidden" name="canonical_word" value="{{ canonical }}">
                                <button type="submit" class="delete-btn" title="–£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ">üóëÔ∏è</button>
                            </form>
                        </div>
                    </div>
                    <div class="synonym-tags">
                        <span style="margin-right: 5px;">–ó–∞–º–µ–Ω—è–µ—Ç:</span>
                        {% for word in find_list %}
                            <span class="synonym-tag">{{ word }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-templates" style="width: 100%;">
                    <p>–°–ª–æ–≤–∞—Ä—å –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–∫–∞ –ø—É—Å—Ç.</p>
                </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function editRule(canonicalWord, findWords) {
        document.getElementById('form-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞';
        document.getElementById('cancel-edit-btn').style.display = 'block';

        const canonicalInput = document.getElementById('canonical_word');
        canonicalInput.value = canonicalWord;
        canonicalInput.readOnly = true;

        document.getElementById('find_words').value = findWords;
        document.getElementById('find_words').focus();
        window.scrollTo(0, 0);
    }

    function cancelEdit() {
        document.getElementById('form-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ';
        document.getElementById('cancel-edit-btn').style.display = 'none';

        const canonicalInput = document.getElementById('canonical_word');
        canonicalInput.readOnly = false;

        document.getElementById('value-dict-form').reset();
    }
</script>
{% endblock %}